/*! CodeOff 15-11-2015 */
angular.module("codeOff",["codeOff.services","codeOff.game","codeOff.select","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/play",{templateUrl:"app/game/game.html",controller:"gameCtrl"}).when("/select",{templateUrl:"app/select/select.html",controller:"selectCtrl"}).otherwise({redirectTo:"/select"})}]),angular.module("codeOff.game",[]).controller("gameCtrl",["$rootScope","$scope","$document","Player","socket",function(a,b,c,d,e){function f(a){b.stats.cpm=b.typed.length/(a-g)*6e4,document.getElementById("cpm").innerText=b.stats.cpm,document.getElementById("timer").innerText=a>=i?"finished!":((i-a)/1e3).toFixed(3)+"s",a>=i||b.typed.length===j.length?(b.gameOver=!0,window.cancelAnimationFrame(h)):window.requestAnimationFrame(f)}var g,h,i=6e4,j=a.sample,k=0,l=a.myColor,m=document.getElementById("cursor");m.style.borderBottom="1px solid "+l,Array.prototype.forEach.call(document.getElementsByClassName("cust-color"),function(a){a.style.color=l}),b.gameOver=!1,b.username=a.myUsername,b.stats={incorrect:{},cpm:0,acc:100},b.typed=[],b.untyped=j.split(""),b.current,c.on("keydown",function(a){a.keyCode&&(8===a.keyCode?a.preventDefault():93===a.keyCode||91===a.keyCode?a.preventDefault():9===a.keyCode&&a.preventDefault())}),b.ready=function(){b.current=b.untyped.shift()},b.keyCheck=function(a){if(!b.gameOver){b.typed.length||(g=performance.now(),h=window.requestAnimationFrame(f));var c=13===a.charCode?"\n":String.fromCharCode(a.charCode);if(c===b.current)b.typed.push(b.current),b.current=b.untyped.shift();else{k++,m.classList?(m.classList.remove("blink"),m.classList.add("shake"),window.setTimeout(function(){m.classList.remove("shake"),m.classList.add("blink")},150)):m.className+=" shake";var d;switch(b.current){case" ":d="[space]";break;case"\n":d="[return]";break;default:d=b.current}b.stats.incorrect.hasOwnProperty(d)?b.stats.incorrect[d]++:b.stats.incorrect[d]=1}b.stats.acc=(b.typed.length-k)/b.typed.length*100}}}]),angular.module("codeOff.select",[]).controller("selectCtrl",["$rootScope","$scope","$location","Player","ColorPicker",function(a,b,c,d,e){b.colorHex="",b.username="",b.room,e.ColorPicker(document.getElementById("slide"),document.getElementById("picker"),function(a,c,d){b.colorHex=a,b.$apply(),document.getElementById("player-color").style.color=a,document.getElementById("submit").style.color=a}),b.play=function(){var e={user:b.username,color:b.colorHex,room:b.room};d.register(e).then(function(d){a.myColor=b.colorHex,a.sample=d,a.myUsername=b.username,c.path("/play")})["catch"](function(a){console.error(a)})}}]),angular.module("codeOff.services",[]).factory("Player",["$http",function(a){var b=function(b){return a({method:"POST",url:"/game/join",data:b}).then(function(a){return a})},c=function(b){return a({method:"POST",url:"/join",data:b}).then(function(a){return a.data})};return{ready:b,register:c}}]).factory("Game",[function(){}]).factory("ColorPicker",[function(){function a(a){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==a.offsetX&&void 0!==a.offsetY)return{x:a.offsetX,y:a.offsetY};var b=a.target.parentNode.parentNode;return{x:a.layerX-b.offsetLeft,y:a.layerY-b.offsetTop}}function b(a,b,c){a=document.createElementNS(o,a);for(var d in b)a.setAttribute(d,b[d]);"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);for(var e=0,f=c[0]&&c.length||0;f>e;e++)a.appendChild(c[e]);return a}function c(a){var b,c,d,e,f,g=a.h%360/60;f=a.v*a.s,e=f*(1-Math.abs(g%2-1)),b=c=d=a.v-f,g=~~g,b+=[f,e,0,0,e,f][g],c+=[e,f,f,e,0,0][g],d+=[0,0,e,f,f,e][g];var h=Math.floor(255*b),i=Math.floor(255*c),j=Math.floor(255*d);return{r:h,g:i,b:j,hex:"#"+(16777216|j|i<<8|h<<16).toString(16).slice(1)}}function d(a){var b=a.r,c=a.g,d=a.b;(a.r>1||a.g>1||a.b>1)&&(b/=255,c/=255,d/=255);var e,f,g,h;return g=Math.max(b,c,d),h=g-Math.min(b,c,d),e=0===h?null:g===b?(c-d)/h+(d>c?6:0):g===c?(d-b)/h+2:(b-c)/h+4,e=e%6*60,f=0===h?0:h/g,{h:e,s:f,v:g}}function e(b,d,e){return function(f){f=f||window.event;var g=a(f);b.h=g.y/d.offsetHeight*360+n;var h=c({h:b.h,s:1,v:1}),i=c({h:b.h,s:b.s,v:b.v});e.style.backgroundColor=h.hex,b.callback&&b.callback(i.hex,{h:b.h-n,s:b.s,v:b.v},{r:i.r,g:i.g,b:i.b},void 0,g)}}function f(b,d){return function(e){e=e||window.event;var f=a(e),g=d.offsetWidth,h=d.offsetHeight;b.s=f.x/g,b.v=(h-f.y)/h;var i=c(b);b.callback&&b.callback(i.hex,{h:b.h-n,s:b.s,v:b.v},{r:i.r,g:i.g,b:i.b},f)}}function g(a,b,c){if(!(this instanceof g))return new g(a,b,c);if(this.h=0,this.s=1,this.v=1,c)this.callback=c,this.pickerElement=b,this.slideElement=a;else{var d=a;d.innerHTML=p,this.slideElement=d.getElementsByClassName("slide")[0],this.pickerElement=d.getElementsByClassName("picker")[0];var j=d.getElementsByClassName("slide-indicator")[0],n=d.getElementsByClassName("picker-indicator")[0];g.fixIndicators(j,n),this.callback=function(a,c,d,e,f){g.positionIndicators(j,n,f,e),b(a,c,d)}}if("SVG"===m){var o=l.cloneNode(!0),r=k.cloneNode(!0),s=o.getElementById("gradient-hsv"),t=o.getElementsByTagName("rect")[0];s.id="gradient-hsv-"+q,t.setAttribute("fill","url(#"+s.id+")");var u=[r.getElementById("gradient-black"),r.getElementById("gradient-white")],v=r.getElementsByTagName("rect");u[0].id="gradient-black-"+q,u[1].id="gradient-white-"+q,v[0].setAttribute("fill","url(#"+u[1].id+")"),v[1].setAttribute("fill","url(#"+u[0].id+")"),this.slideElement.appendChild(o),this.pickerElement.appendChild(r),q++}else this.slideElement.innerHTML=l,this.pickerElement.innerHTML=k;h(this.slideElement,"click",e(this,this.slideElement,this.pickerElement)),h(this.pickerElement,"click",f(this,this.pickerElement)),i(this,this.slideElement,e(this,this.slideElement,this.pickerElement)),i(this,this.pickerElement,f(this,this.pickerElement))}function h(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,!1)}function i(a,b,c){var d=!1;h(b,"mousedown",function(a){d=!0}),h(b,"mouseup",function(a){d=!1}),h(b,"mouseout",function(a){d=!1}),h(b,"mousemove",function(a){d&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,c(a))})}function j(a,b,d,e){a.h=b.h%360,a.s=b.s,a.v=b.v;var f=c(a),g={y:a.h*a.slideElement.offsetHeight/360,x:0},h=a.pickerElement.offsetHeight,i={x:a.s*a.pickerElement.offsetWidth,y:h-a.v*h};return a.pickerElement.style.backgroundColor=c({h:a.h,s:1,v:1}).hex,a.callback&&a.callback(e||f.hex,{h:a.h,s:a.s,v:a.v},d||{r:f.r,g:f.g,b:f.b},i,g),a}var k,l,m=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",n=15,o="http://www.w3.org/2000/svg",p=['<div class="picker-wrapper">','<div class="picker"></div>','<div class="picker-indicator"></div>',"</div>",'<div class="slide-wrapper">','<div class="slide"></div>','<div class="slide-indicator"></div>',"</div>"].join("");"SVG"===m?(l=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[b("defs",{},b("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),b("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),b("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),b("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),b("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),b("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),b("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),b("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),b("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),k=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[b("defs",{},[b("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),b("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),b("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),b("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})])):"VML"===m&&(l=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</DIV>"].join(""),k=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</DIV>"].join(""),document.namespaces.v||document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"));var q=0;return g.hsv2rgb=function(a){var b=c(a);return delete b.hex,b},g.hsv2hex=function(a){return c(a).hex},g.rgb2hsv=d,g.rgb2hex=function(a){return c(d(a)).hex},g.hex2hsv=function(a){return d(g.hex2rgb(a))},g.hex2rgb=function(a){return{r:parseInt(a.substr(1,2),16),g:parseInt(a.substr(3,2),16),b:parseInt(a.substr(5,2),16)}},g.prototype.setHsv=function(a){return j(this,a)},g.prototype.setRgb=function(a){return j(this,d(a),a)},g.prototype.setHex=function(a){return j(this,g.hex2hsv(a),void 0,a)},g.positionIndicators=function(a,b,c,d){c&&(a.style.top=c.y-a.offsetHeight/2+"px"),d&&(b.style.top=d.y-b.offsetHeight/2+"px",b.style.left=d.x-b.offsetWidth/2+"px")},g.fixIndicators=function(a,b){b.style.pointerEvents="none",a.style.pointerEvents="none"},{ColorPicker:g}}]);